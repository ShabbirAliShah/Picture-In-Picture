/*! @name @brightcove/videojs-pip @version 2.0.0 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("@brightcove/loscore")):"function"==typeof define&&define.amd?define(["video.js","@brightcove/loscore"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsPip=t(e.videojs,e.videojs.bc_)}(this,(function(e,t){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=i(e),o=i(t);const n=document.documentElement,a=document.body,l=e=>{const t=s.default.dom.getBoundingClientRect(e),i=((e,t)=>{const i=Math.max(e.top,t.top),s=Math.min(e.bottom,t.bottom),o=Math.max(e.left,t.left),n=Math.min(e.right,t.right),a=n-o,l=s-i;return a>=0&&l>=0&&{top:i,bottom:s,left:o,right:n,width:a,height:l}})({top:0,left:0,right:n.clientWidth||a.clientWidth,width:n.clientWidth||a.clientWidth,bottom:n.clientHeight||a.clientHeight,height:n.clientHeight||a.clientHeight},t),o=t.width*t.height,l=i.width*i.height;return o?l/o:0};class r{constructor(e,t,i,s){this.el_=e,this.threshold_=t,this.callback_=i,this.supportsIO_=s,this.observing_=!1,void 0===s&&(this.supportsIO_="IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype),this.supportsIO_?this.io_=new window.IntersectionObserver((s=>{for(let o=0;o<s.length;o++)if(s[o].target===e)return i(s[o].intersectionRatio>=t)}),{threshold:t}):this.boundCheckForIntersection_=o.default.throttle((e=>this.checkForIntersection_(e)),500)}observe(){this.observing_||(this.observing_=!0,this.supportsIO_?this.io_.observe(this.el_):(s.default.on(window,"resize",this.boundCheckForIntersection_),s.default.on(document,"scroll",this.boundCheckForIntersection_)))}unobserve(){this.observing_&&(this.observing_=!1,this.supportsIO_?this.io_.unobserve(this.el_):(s.default.off(window,"resize",this.boundCheckForIntersection_),s.default.off(document,"scroll",this.boundCheckForIntersection_)))}dispose(){this.unobserve(),this.io_=null,this.el_=null,this.callback_=null}checkForIntersection_(){if("none"===window.getComputedStyle(this.el_).display)return;const e=l(this.el_);this.callback_(e>=this.threshold_)}}const{IS_ANDROID:h,IS_IOS:c}=s.default.browser,d=s.default.getComponent("CloseButton"),p=s.default.getPlugin("plugin"),u="vjs-pip",v="vjs-pip-container",_={allowOnMobile:!1,closeable:!0,height:null,manualContainerSize:!1,posX:"right",posY:"bottom",scale:2/3,useIntersectionObserver_:void 0,viewable:.8,width:null},b=["left","right"],f=["top","bottom"],g=e=>e&&"div"===e.tagName.toLowerCase(),m=e=>g(e)&&e.hasAttribute("style"),w=e=>g(e)&&s.default.dom.hasClass(e,v);class y extends p{constructor(e,t){return super(e),this.containerEl()?(this.setOptions(t),this.options.allowOnMobile||!h&&!c?(this.oneWindowScroll_=this.oneWindowScroll_.bind(this),window.addEventListener("scroll",this.oneWindowScroll_),this.observe_(),e.addClass(u),e.fluid()||this.options.manualContainerSize||(this.setContainerSize_(this.player.currentDimensions()),this.on(e,"playerresize",this.onPlayerResize_)),this.on(e,"fullscreenchange",this.onFullscreenChange_),void this.enable()):this.dispose()):this.dispose()}setOptions({allowOnMobile:e,closeable:t,height:i,manualContainerSize:n,posX:a,posY:l,scale:r,useIntersectionObserver_:h,width:c,viewable:d}={}){o.default.isObj(this.options)||(this.options=s.default.mergeOptions(_)),"boolean"==typeof e&&(this.options.allowOnMobile=e),this.options.manualContainerSize="boolean"==typeof n?n:this.containerEl().hasAttribute("data-manual-container-size"),"boolean"==typeof t&&(this.options.closeable=t),(null===i||o.default.isNum(i))&&(this.options.height=i),(null===c||o.default.isNum(c))&&(this.options.width=c),o.default.isNum(r)&&r>0&&r<=1&&(this.options.scale=r),-1!==b.indexOf(a)&&(this.options.posX=a),-1!==f.indexOf(l)&&(this.options.posY=l),void 0!==h&&(this.options.useIntersectionObserver_=h),o.default.isNum(d)&&d>=0&&d<=1&&(this.options.viewable=d)}isLegacyResponsive_(){const e=this.player.el().parentElement;return!w(e)&&m(e)&&m(e.parentElement)&&w(e.parentElement.parentElement)}isStudioResponsive_(){const e=this.player.el().parentElement;return!w(e)&&m(e)&&w(e.parentElement)}containerEl(){if(this.containerEl_)return this.containerEl_;let e=this.player.el().parentElement;if(this.isStudioResponsive_()?(e=e.parentElement,s.default.dom.addClass(e,"vjs-pip-studio-responsive"),this.setState({studioResponsive:!0})):this.isLegacyResponsive_()&&(e=e.parentElement.parentElement,s.default.dom.addClass(e,"vjs-pip-legacy-responsive"),this.setState({legacyResponsive:!0})),s.default.dom.hasClass(e,v))return e;s.default.log.warn('expected player to be a child of a "vjs-pip-container" element, cannot continue with picture-in-picture plugin')}enable(){this.state.enabled||(this.player.trigger("beforepipenabled"),this.setState({enabled:!0}),this.observe_(),this.player.trigger("pipenabled"))}disable(){this.state.enabled&&(this.player.trigger("beforepipdisabled"),this.state.active&&this.deactivate(),this.setState({enabled:!1}),this.unobserve_(),this.player.trigger("pipdisabled"))}activate(e=!0){const{player:t}=this;this.state.enabled&&!this.state.active&&this.state.haveSeenScroll&&t.hasStarted()&&(this.setState({manualActivation:e}),this.storeBeforeActiveState_(),t.trigger("beforepipactive"),this.setState({active:!0}),this.setContainerSize_(),this.scalePlayer_(),this.addCloseButton_(),t.fluid(!1),this.setActiveClasses_(),this.observe_(),t.trigger("pipactive"))}deactivate(){const{player:e}=this;this.state.enabled&&this.state.active&&(e.trigger("beforepipinactive"),this.unsetContainerSize_(),this.restorePlayer_(),this.removeCloseButton_(),this.beforeActiveState_.wasFluid_&&e.fluid(!0),this.setInactiveClasses_(),this.setState({active:!1}),e.trigger("pipinactive"))}toggle(){this.state.active?this.deactivate():this.activate(!1)}observe_(){const{options:e,player:t,state:i}=this,s=i.active?this.containerEl():t.el();this.vo_&&this.vo_.el_!==s&&(this.vo_.dispose(),this.vo_=null),this.vo_||(this.vo_=new r(s,e.viewable,(e=>this.onViewableChange_(e)),e.useIntersectionObserver_)),this.vo_.observe()}unobserve_(){this.vo_&&this.vo_.unobserve()}storeBeforeActiveState_(){const{options:e,player:t,state:i}=this;if(i.isFullscreen)return;const s=this.beforeActiveState_={activeClasses:["vjs-pip-active",`vjs-pip-x-${e.posX}`,`vjs-pip-y-${e.posY}`],inactiveClasses:["vjs-pip-inactive"],playerDimensions:t.currentDimensions(),wasFluid_:t.fluid()};if(["vjs-16-9","vjs-4-3","vjs-fill"].forEach((e=>{t.hasClass(e)&&s.inactiveClasses.push(e)})),!e.manualContainerSize){const{style:e}=this.containerEl();s.containerDimensions={height:e.height,width:e.width}}if(i.legacyResponsive){const{style:e}=t.el();s.playerStyle={height:e.height,width:e.width}}}clearBeforeActiveState_(){this.beforeActiveState_=null}setContainerSize_(e=this.beforeActiveState_.playerDimensions){if(this.options.manualContainerSize)return;const{style:t}=this.containerEl();["height","width"].forEach((i=>{o.default.isNum(e[i])?t[i]=e[i]+"px":t[i]=null}))}unsetContainerSize_(){if(this.options.manualContainerSize)return;const{containerDimensions:e}=this.beforeActiveState_,{style:t}=this.containerEl();t.height=e.height,t.width=e.width}scalePlayer_(){const{options:e,player:t,state:i}=this;let{height:s,scale:n,width:a}=e;const l=o.default.isNum(s),r=o.default.isNum(a),{playerDimensions:h}=this.beforeActiveState_;if(l||r){const e=h.width/h.height;l||(s=a/e),r||(a=s*e)}else s=Math.round(h.height*n),a=Math.round(h.width*n);if(i.legacyResponsive){const{style:e}=t.el();e.height=`${s}px`,e.width=`${a}px`}else t.dimension("height",s),t.dimension("width",a)}restorePlayer_(){const{player:e,state:t}=this,{style:i}=e.el(),{playerDimensions:s,playerStyle:o}=this.beforeActiveState_;t.legacyResponsive?(i.height=o.height,i.width=o.width):t.studioResponsive?(i.height="",i.width=""):e.dimensions(s.width,s.height)}addCloseButton_(){if(!this.options.closeable)return;const{player:e}=this,t=this.closeButton_=new d(e);t.addClass("vjs-pip-close-button"),t.on("close",(()=>{e.trigger("beforepipclose"),e.pause(),this.disable(),e.trigger("pipclose")})),e.addChild(t)}removeCloseButton_(){this.closeButton_&&(this.closeButton_.dispose(),this.closeButton_=null)}setActiveClasses_(){const{player:e}=this,{activeClasses:t,inactiveClasses:i}=this.beforeActiveState_;t.forEach((t=>e.addClass(t))),i.forEach((t=>e.removeClass(t)))}setInactiveClasses_(){const{player:e}=this,{activeClasses:t,inactiveClasses:i}=this.beforeActiveState_;t.forEach((t=>e.removeClass(t))),i.forEach((t=>e.addClass(t)))}onViewableChange_(e){this.setState({viewable:e}),e?this.state.manualActivation?this.setState({manualActivation:!1}):this.deactivate():this.activate(!1)}onPlayerResize_(){const{player:e}=this;e.fluid()||this.state.active||this.options.manualContainerSize||this.setContainerSize_(this.player.currentDimensions())}oneWindowScroll_(){window.removeEventListener("scroll",this.oneWindowScroll_),this.setState({haveSeenScroll:!0})}onFullscreenChange_(){this.setState({isFullscreen:!this.state.isFullscreen}),this.state.isFullscreen&&(this.setState({haveSeenScroll:!1}),window.addEventListener("scroll",this.oneWindowScroll_))}dispose(){this.state.active&&this.deactivate(),this.disable(),window.removeEventListener("scroll",this.oneWindowScroll_),super.dispose()}}return y.defaultState={active:!1,enabled:!1,haveSeenScroll:!1,legacyResponsive:!1,viewable:!1,isFullscreen:!1},y.VERSION="2.0.0",s.default.registerPlugin("pip",y),y}));